# dbt Analytics Component with materialization-based automation policies
# - Views: code_version_changed | newly_updated (refresh on code change)
# - Mart tables: on_cron daily at 6 AM UTC
# - Other tables: on_cron hourly
#
# Each model is tagged with `dagster/materialization` based on its dbt config,
# enabling programmatic selection in schedules and jobs.
type: dbt_automation_demo.defs.analytics.component.CustomDbtComponent

attributes:
  project:
    project_dir: "{{ project_root }}/analytics_dbt"
    profiles_dir: "{{ project_root }}/analytics_dbt"
---
# Hourly schedule for dbt tables (excluding views) with run-in-progress protection
# Uses the `dagster/materialization` tag to programmatically select only tables
# Before each tick, checks if selected assets are already running and skips if so
type: dbt_automation_demo.defs.components.safe_scheduled_job_component.SafeScheduledJobComponent

attributes:
  job_name: "hourly_dbt_tables_job"
  cron_schedule: "0 * * * *"  # Every hour on the hour
  asset_selection: "tag:dagster/materialization=table"  # Programmatically select tables, exclude views
  skip_reason_prefix: "Hourly dbt tables schedule"
